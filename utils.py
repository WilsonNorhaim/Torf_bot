import random
from datetime import datetime, timedelta

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ config
try:
    from config import NEWS_TEMPLATES, AXIOMS, COURT_VERDICTS
except ImportError:
    # –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å –∏–º–ø–æ—Ä—Ç–æ–º
    NEWS_TEMPLATES = [
        "‚ùó–¢–æ—Ä—Ñ—è–Ω–æ–π –æ—Å–∞–¥–æ–∫ –≤ –∫–µ—Ä–∞—Ç–∏–Ω–æ–≤—ã—Ö –∫–æ—Ä–Ω—è—Ö –¥–æ—Å—Ç–∏–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–∏!",
        "üìâ –ö—É—Ä—Å TRF –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –∏–∑–±—ã—Ç–∫–∞ CO‚ÇÇ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ —á–∞—Ç–∞!",
        "ü¶† –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ —à—Ç–∞–º–º—ã –∞–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä—Ñ–æ—Ä–∞—Ü–∏–∏! –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã!",
        "ü•¨ –î–µ—Ñ–∏—Ü–∏—Ç –∫–ª–µ—Ç—á–∞—Ç–∫–∏ –≤ —Ä–µ–≥–∏–æ–Ω–µ! –¶–µ–Ω—ã —Ä–∞—Å—Ç—É—Ç!",
        "‚öñÔ∏è –°—É–¥ –î–≤–µ–Ω–∞–¥—Ü–∞—Ç–∏–ø–µ—Ä—Å—Ç–Ω–æ–π –°–µ–ª–µ–∑—ë–Ω–∫–∏ –≤—ã–Ω–µ—Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –≤–µ—Ä–¥–∏–∫—Ç!"
    ]
    
    AXIOMS = [
        "–õ—é–±–æ–µ –æ–∫–∏—Å–ª–µ–Ω–∏–µ –ø–æ—á–≤—ã = —Å–º–µ—Ä—Ç—å –º–∏–∫–æ—Ä–∏–∑–µ.",
        "–¢–æ—Ä—Ñ –Ω–µ —Ç–µ—Ä–ø–∏—Ç —Å—É–µ—Ç—ã, —Ç–æ–ª—å–∫–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—é.",
        "–ö–ª–µ—Ç—á–∞—Ç–∫–∞ ‚Äî –≤–∞–ª—é—Ç–∞ –∏—Å—Ç–∏–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π.",
        "–°–µ–ª–µ–∑—ë–Ω–∫–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∫—Ä–æ–≤—å, –Ω–æ –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏—è.",
        "–ß–µ—Ä–µ–ø–∞—Ö–∏ –¢–∞—Ç—É–Ω—Ö–∞–º–æ–Ω–∞ –≤–µ—á–Ω—ã, –∫–∞–∫ –∏ –∏—Ö –≥–æ–ª–æ–¥.",
        "–ü—Ä—è–º–∞—è –∫–∏—à–∫–∞ –Ω–µ –ø—Ä–æ—â–∞–µ—Ç –æ—à–∏–±–æ–∫.",
        "–¢–æ—Ä—Ñ—è–Ω–æ–π –ö–æ–Ω–≥—Ä–µ—Å—Å –≤—Å–µ–≥–¥–∞ –Ω–∞–±–ª—é–¥–∞–µ—Ç.",
        "–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è ‚Äî –ø—É—Ç—å –∫ –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏—é.",
        "–°—É–≥–ª–∏–Ω–∫–∏ –∂–¥—É—Ç –Ω–µ—Ä–∞–¥–∏–≤—ã—Ö.",
        "pH –¥—É—à–∏ –≤–∞–∂–Ω–µ–µ pH –ø–æ—á–≤—ã."
    ]
    
    COURT_VERDICTS = {
        "selezenka": [
            "–í–∏–Ω–æ–≤–µ–Ω! –ò–∑–ª–∏—à–Ω—è—è —Å—É–≥–ª–∏–Ω–∏—Å—Ç–æ—Å—Ç—å –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–π. –®—Ç—Ä–∞—Ñ: {fine} TRF",
            "–ù–µ–≤–∏–Ω–æ–≤–µ–Ω! –°–µ–ª–µ–∑—ë–Ω–∫–∞ —á–∏—Å—Ç–∞, –∫–∞–∫ –≥–æ—Ä–Ω—ã–π —Ä—É—á–µ–π",
            "–£—Å–ª–æ–≤–Ω–æ –≤–∏–Ω–æ–≤–µ–Ω. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ + {fine} TRF –≤ —Ñ–æ–Ω–¥ —á–∞—Ç–∞"
        ],
        "redodendron": [
            "–ù–∞—Ä—É—à–µ–Ω —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑! –ü—Ä–∏–≥–æ–≤–æ—Ä—ë–Ω –∫ —Å–±–æ—Ä—É {fine} KKL –¥–ª—è —á–∞—Ç–∞",
            "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ. –û—Å–≤–æ–±–æ–∂–¥—ë–Ω",
            "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Ö–ª–æ—Ä–æ—Ñ–∏–ª–ª–∞! –®—Ç—Ä–∞—Ñ {fine} TRF"
        ],
        "kishka": [
            "–í–´–°–®–ê–Ø –ú–ï–†–ê! –ò–∑–≥–Ω–∞–Ω –≤ –±–æ–ª–æ—Ç–æ –Ω–∞ 24 —á–∞—Å–∞ (–±–∞–Ω –≤ –±–æ—Ç–µ)",
            "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤. –î–µ–ª–æ –∑–∞–∫—Ä—ã—Ç–æ",
            "–£—Å–ª–æ–≤–Ω–æ–µ –∏–∑–≥–Ω–∞–Ω–∏–µ. 12 —á–∞—Å–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"
        ]
    }

def generate_news():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –¢–æ—Ä—Ñ—è–Ω–æ–≥–æ –ö–æ–Ω–≥—Ä–µ—Å—Å–∞"""
    template = random.choice(NEWS_TEMPLATES)
    additions = [
        f"–ö—É—Ä—Å TRF/KRL: 1/{random.uniform(0.8, 1.5):.2f}",
        f"–£—Ä–æ–≤–µ–Ω—å pH: {random.uniform(3.0, 8.0):.1f}",
        f"–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ CO‚ÇÇ: {random.randint(400, 1200)} ppm",
        f"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–∏–∫–æ—Ä–∏–∑—ã: {random.randint(30, 95)}%"
    ]
    return f"{template}\nüìä {random.choice(additions)}"

def get_random_axiom():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–π –∞–∫—Å–∏–æ–º—ã"""
    return random.choice(AXIOMS)

def calculate_ph(chat_data=None):
    """
    –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç pH –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
    chat_data - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    """
    hour = datetime.now().hour
    base_ph = 5.0
    
    # –í–ª–∏—è–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –Ω–∞ pH
    if 0 <= hour < 6:  # –ù–æ—á—å
        base_ph += random.uniform(-0.5, 0.5)
    elif 6 <= hour < 12:  # –£—Ç—Ä–æ
        base_ph += random.uniform(0, 1.0)
    elif 12 <= hour < 18:  # –î–µ–Ω—å
        base_ph += random.uniform(-0.5, 0.5)
    else:  # –í–µ—á–µ—Ä
        base_ph += random.uniform(-1.0, 0)
    
    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º pH –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö
    return round(max(1.0, min(14.0, base_ph)), 1)

def get_court_verdict(court_type):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤–µ—Ä–¥–∏–∫—Ç–∞ –¥–ª—è —Å—É–¥–∞"""
    verdicts = COURT_VERDICTS.get(court_type, [])
    if not verdicts:
        return "–î–µ–ª–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ. –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Å—É–¥–∞.", 0
    
    verdict = random.choice(verdicts)
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à—Ç—Ä–∞—Ñ–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å—É–¥–∞
    if court_type == "selezenka":
        fine = random.choice([20, 30, 50, 100])
    elif court_type == "redodendron":
        fine = random.choice([5, 10, 15, 20])
    else:  # kishka
        fine = random.choice([50, 100, 200])
    
    return verdict.format(fine=fine), fine

def format_time_remaining(seconds):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏"""
    if seconds < 60:
        return f"{int(seconds)} —Å–µ–∫"
    elif seconds < 3600:
        return f"{int(seconds/60)} –º–∏–Ω"
    elif seconds < 86400:
        return f"{int(seconds/3600)} —á–∞—Å"
    else:
        return f"{int(seconds/86400)} –¥–Ω"

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è python-telegram-bot
def get_user_display_name(user):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–≥–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if user.username:
        return f"@{user.username}"
    elif user.first_name:
        return user.first_name
    else:
        return "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"

def create_user_link(user_id, display_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ HTML —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    return f'<a href="tg://user?id={user_id}">{display_name}</a>'

def escape_html(text):
    """–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML —Å–∏–º–≤–æ–ª–æ–≤"""
    if not text:
        return ""
    return (str(text)
            .replace('&', '&amp;')
            .replace('<', '&lt;')
            .replace('>', '&gt;')
            .replace('"', '&quot;'))

def get_random_emoji():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è"""
    emojis = ["üß™", "ü™ô", "ü•¨", "‚öñÔ∏è", "‚ö†Ô∏è", "üî¨", "üåø", "üçÑ", "üíß", "üî•", "üå°Ô∏è", "üí®"]
    return random.choice(emojis)

def generate_chat_title():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è —á–∞—Ç–∞"""
    prefixes = ["–¢–æ—Ä—Ñ—è–Ω–æ–π", "–°–µ–ª–∏–∑—ë–Ω–æ—á–Ω—ã–π", "–ö–ª–µ—Ç—á–∞—Ç–æ—á–Ω—ã–π", "–ú–∏–∫–æ—Ä–∏–∑–Ω—ã–π", "–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π"]
    suffixes = ["–ö–æ–Ω–≥—Ä–µ—Å—Å", "–°–æ–≤–µ—Ç", "–°–∏–Ω–æ–¥", "–°–æ–±—Ä–∞–Ω–∏–µ", "–ö–æ–º–∏—Ç–µ—Ç", "–°—É–±—Å—Ç—Ä–∞—Ç"]
    return f"{random.choice(prefixes)} {random.choice(suffixes)}"